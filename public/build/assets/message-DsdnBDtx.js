const s=$('meta[name="selected_contact"]'),c=$('meta[name="base_url"]').attr("content"),o=$(".messages ul"),l=$(".message"),r=$('meta[name="auth_id"]').attr("content");function d(){$(".loader").toggleClass("d-none")}function a(t,e){return`
        <li  class="${e}">
            <img src="${c}/images/avatar.jpg" alt="avatar" />
            <p>${t}</p>
        </li>
    `}function i(){$(".messages").stop().animate({scrollTop:$(".messages")[0].scrollHeight},500)}function m(t){$.ajax({url:c+"/messages",method:"GET",data:{contact_id:t},beforeSend:function(){d()},success:function(e){f(e.contact),e.messages.forEach(n=>{n.from_id===e.contact.id?o.append(a(n.message,"sent")):o.append(a(n.message,"replies"))}),i()},error:function(e){console.error("Error fetching messages:",e)},complete:function(){d()}})}function f(t){$(".contact-name").text(t.name)}function g(){const t=s.attr("content"),e=$(".message-form").serialize();$.ajax({url:c+"/send-message",method:"POST",data:e+"&contact_id="+t,beforeSend:function(){i()},success:function(n){},error:function(n){console.error("Error sending message:",n)}})}$(document).ready(function(){$(".contact").on("click",function(){const t=$(this).data("id");s.attr("content",t),$(".empty-box").addClass("d-none"),o.empty(),m(t)}),$(".message-form").on("submit",function(t){t.preventDefault(),o.append(a(l.val(),"replies")),g(),l.val("")})});window.Echo.private("message."+r).listen("SendMessageEvent",function(t){console.log(t);const e=s.attr("content");console.log(t.to_id,e),t.from_id==e&&(o.append(a(t.text,"sent")),i())});window.Echo.join("online").here(t=>{console.log(t),t.forEach(e=>{$(`.contact[data-id='${e.id}']`).find(".contact-status").removeClass("offline").addClass("online")})}).joining(t=>{console.log(t),$(`.contact[data-id='${t.id}']`).find(".contact-status").removeClass("offline").addClass("online")}).leaving(t=>{console.log(t),$(`.contact[data-id='${t.id}']`).find(".contact-status").removeClass("online").addClass("offline")});
